{% extends "base.html" %}

{% block title %}FortiSwitch Details{% endblock %}

{% block content %}
<div class="container mt-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('fortiswitch.index') }}">FortiSwitches</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ switch.name }}</li>
        </ol>
    </nav>

    <div class="row">
        <div class="col-md-12 mb-4">
            <div class="card">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Switch Details</h5>
                    <div>
                        <a href="{{ url_for('fortiswitch.ip_change_form', switch_id=switch_id) }}" class="btn btn-warning btn-sm">
                            <i class="fas fa-edit"></i> Change IP Address
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-bordered">
                                <tr>
                                    <th style="width: 30%">Name</th>
                                    <td>{{ switch.name }}</td>
                                </tr>
                                <tr>
                                    <th>Serial Number</th>
                                    <td>{{ switch.serial }}</td>
                                </tr>
                                <tr>
                                    <th>IP Address</th>
                                    <td>{{ switch.get('fsw-wan1-ip', 'N/A') }}</td>
                                </tr>
                                <tr>
                                    <th>Netmask</th>
                                    <td>{{ switch.get('fsw-wan1-netmask', 'N/A') }}</td>
                                </tr>
                                <tr>
                                    <th>Status</th>
                                    <td>
                                        {% if switch.status == 'online' %}
                                            <span class="badge bg-success">Online</span>
                                        {% elif switch.status == 'offline' %}
                                            <span class="badge bg-danger">Offline</span>
                                        {% else %}
                                            <span class="badge bg-secondary">{{ switch.status }}</span>
                                        {% endif %}
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <table class="table table-bordered">
                                <tr>
                                    <th style="width: 30%">Version</th>
                                    <td>{{ switch.version }}</td>
                                </tr>
                                <tr>
                                    <th>Model</th>
                                    <td>{{ switch.model }}</td>
                                </tr>
                                <tr>
                                    <th>Platform</th>
                                    <td>{{ switch.platform }}</td>
                                </tr>
                                <tr>
                                    <th>Connection</th>
                                    <td>{{ switch.connection }}</td>
                                </tr>
                                <tr>
                                    <th>Last Seen</th>
                                    <td>{{ switch.get('last-seen', 'N/A') }}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12 mb-4">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">Connected Devices</h5>
                </div>
                <div class="card-body">
                    {% if devices %}
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>MAC Address</th>
                                        <th>IP Address</th>
                                        <th>Host Name</th>
                                        <th>Port</th>
                                        <th>VLAN</th>
                                        <th>Online Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for device in devices %}
                                    <tr>
                                        <td>{{ device.mac }}</td>
                                        <td>{{ device.ip }}</td>
                                        <td>{{ device.get('host-name', 'N/A') }}</td>
                                        <td>{{ device.port }}</td>
                                        <td>{{ device.vlan }}</td>
                                        <td>
                                            {% if device.online %}
                                                <span class="badge bg-success">Online</span>
                                            {% else %}
                                                <span class="badge bg-danger">Offline</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="alert alert-info">
                            No devices are connected to this switch.
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12 mb-4">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">Switch Ports</h5>
                </div>
                <div class="card-body">
                    {% if ports %}
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Port</th>
                                        <th>Status</th>
                                        <th>Speed</th>
                                        <th>Duplex</th>
                                        <th>VLAN</th>
                                        <th>Type</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for port in ports %}
                                    <tr>
                                        <td>{{ port.port }}</td>
                                        <td>
                                            {% if port.status == 'up' %}
                                                <span class="badge bg-success">Up</span>
                                            {% elif port.status == 'down' %}
                                                <span class="badge bg-danger">Down</span>
                                            {% else %}
                                                <span class="badge bg-secondary">{{ port.status }}</span>
                                            {% endif %}
                                        </td>
                                        <td>{{ port.speed }}</td>
                                        <td>{{ port.duplex }}</td>
                                        <td>{{ port.vlan }}</td>
                                        <td>{{ port.type }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="alert alert-info">
                            No port information available.
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    $(document).ready(function() {
        // Auto-refresh the page every 30 seconds
        setTimeout(function() {
            location.reload();
        }, 30000);
    });
</script>
{% endblock %}