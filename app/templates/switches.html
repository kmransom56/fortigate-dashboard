<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Unified FortiGate Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        .summary-widget {
            display: flex;
            justify-content: space-between;
            padding: 1em;
            background-color: #f8f9fa;
            border-radius: 0.5em;
            margin-bottom: 1em;
        }
        .summary-widget div {
            text-align: center;
        }
        .summary-widget div h3 {
            margin: 0;
            font-size: 1.5em;
        }
        .summary-widget div p {
            margin: 0;
            font-size: 1em;
            color: #6c757d;
        }
        .hierarchical-table {
            width: 100%;
            border-collapse: collapse;
        }
        .hierarchical-table th, .hierarchical-table td {
            border: 1px solid #dee2e6;
            padding: 0.75em;
            text-align: left;
        }
        .hierarchical-table th {
            background-color: #e9ecef;
        }
        .hierarchical-table .expandable-row {
            cursor: pointer;
        }
        .hierarchical-table .hidden-row {
            display: none;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <h1>Unified FortiGate Dashboard</h1>

    <!-- Summary Widgets -->
    <div class="summary-widget">
        <div>
            <h3 id="device-count">0</h3>
            <p>Connected Devices</p>
        </div>
        <div>
            <h3 id="switch-count">0</h3>
            <p>FortiSwitches</p>
        </div>
        <div>
            <h3 id="status-count">0</h3>
            <p>System Status</p>
        </div>
    </div>

    <!-- Hierarchical Table -->
    <table class="hierarchical-table">
        <thead>
            <tr>
                <th>Type</th>
                <th>Name</th>
                <th>IP Address</th>
                <th>MAC Address</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="dashboard-table-body">
            <!-- Data will be dynamically loaded here -->
        </tbody>
    </table>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Fetch and populate summary widgets
        fetch('/api/dashboard-summary')
            .then(response => response.json())
            .then(data => {
                document.getElementById('device-count').textContent = data.deviceCount;
                document.getElementById('switch-count').textContent = data.switchCount;
                document.getElementById('status-count').textContent = data.statusCount;
            })
            .catch(error => console.error('Error fetching summary:', error));

        // Fetch and populate hierarchical table
        fetch('/api/dashboard-data')
            .then(response => response.json())
            .then(data => {
                const tableBody = document.getElementById('dashboard-table-body');
                tableBody.innerHTML = '';

                data.forEach(entry => {
                    const row = document.createElement('tr');
                    row.className = 'expandable-row';
                    row.innerHTML = `
                        <td>${entry.type}</td>
                        <td>${entry.name}</td>
                        <td>${entry.ip}</td>
                        <td>${entry.mac}</td>
                        <td>${entry.status}</td>
                        <td><button class="btn btn-sm btn-info">Details</button></td>
                    `;
                    tableBody.appendChild(row);

                    if (entry.children && entry.children.length > 0) {
                        const hiddenRow = document.createElement('tr');
                        hiddenRow.className = 'hidden-row';
                        hiddenRow.innerHTML = `<td colspan="6">${JSON.stringify(entry.children)}</td>`;
                        tableBody.appendChild(hiddenRow);

                        row.addEventListener('click', function() {
                            hiddenRow.style.display = hiddenRow.style.display === 'none' ? '' : 'none';
                        });
                    }
                });
            })
            .catch(error => console.error('Error fetching dashboard data:', error));
    });
</script>
</body>
</html>
