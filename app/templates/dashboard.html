<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FortiGate Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
</head>
<body>
<div class="container mt-5">
  <div class="mb-4 text-center">
    <a href="/dashboard.html" class="d-inline-block text-decoration-none">
      <img src="https://cdn-icons-png.flaticon.com/512/565/565547.png" alt="Firewall" style="height:60px;width:60px;object-fit:contain;vertical-align:middle;">
      <span class="fw-bold ms-2" style="font-size:1.3rem;vertical-align:middle;">View Fortigate</span>
    </a>
  </div>
  <h1 class="mb-3"><i class="fa-solid fa-chart-line"></i> FortiGate Dashboard</h1>

  <div class="mt-5">
    <h2><i class="fa-solid fa-diagram-project"></i> Network Map</h2>
    <div id="network" style="height: 400px; border: 1px solid lightgray;"></div>
  </div>

  <div class="table-responsive mt-5">
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th>Device Name</th>
          <th>Status</th>
          <th>IP Address</th>
          <th>Last Update</th>
        </tr>
      </thead>
      <tbody>
        {% for name, iface in interfaces.items() %}
        <tr>
          <td>{{ iface.name }}</td>
          <td>{{ iface.status }}</td>
          <td>{{ iface.ip }}</td>
          <td>{{ iface.last_update | default('N/A') }}</td>
        </tr>
        {% else %}
        <tr>
          <td colspan="4">No interfaces data available.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="mt-4">
    <a href="/" class="btn btn-outline-primary"><i class="fa-solid fa-arrow-left"></i> Back to Home</a>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const interfacesData = {{ interfaces | tojson }};
    updateNetwork(interfacesData);
  });

  function updateNetwork(interfaces) {
    const container = document.getElementById('network');
    if (!container) return;

    const nodes = new vis.DataSet();
    const edges = [];
    const nodeMeta = {};

    // Add FortiGate node
    nodes.add({
      id: 1,
      label: "FortiGate",
      shape: "icon",
      icon: {
        face: "FontAwesome",
        code: "\uf233",  // fa-server
        size: 50,
        color: "#e74c3c"
      }
    });

    let interfaceNodeId = 2;
    for (const key in interfaces) {
      if (interfaces.hasOwnProperty(key)) {
        const iface = interfaces[key];
        const ifaceNodeId = interfaceNodeId++;
        nodes.add({
          id: ifaceNodeId,
          label: `${iface.name}\\n${iface.ip || 'No IP'}`,
          shape: "icon",
          icon: {
            face: "FontAwesome",
            code: "\uf0e8",  // fa-ethernet or similar
            size: 30,
            color: "#3498db"
          }
        });
        edges.push({ from: 1, to: ifaceNodeId });
        nodeMeta[ifaceNodeId] = { ip: iface.ip, name: iface.name };
      }
    }

    const network = new vis.Network(container, { nodes, edges }, {
      nodes: {
        shapeProperties: { useImageSize: true },
        font: { size: 14 }
      },
      edges: { width: 2 },
      physics: true
    });

    network.on("click", function (params) {
      const nodeId = params.nodes[0];
      if (!nodeId || !nodeMeta[nodeId]) return;
      const { ip, name } = nodeMeta[nodeId];
      if (ip) {
        alert(`Interface: ${name}\nIP: ${ip}`);
      } else {
        alert(`Interface: ${name}\nNo IP address available.`);
      }
    });
  }
</script>
</body>
</html>
