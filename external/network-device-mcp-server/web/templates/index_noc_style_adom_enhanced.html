<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice-Enabled Network Management Platform - ADOM Enhanced</title>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* NOC Style Base */
        body { 
            margin: 0; 
            display: flex; 
            height: 100vh; 
            overflow: hidden; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #fff;
        }
        
        /* Sidebar Panel */
        #control-panel { 
            width: 280px; 
            background: #2d2d2d; 
            padding: 15px; 
            overflow-y: auto;
            border-right: 2px solid #404040;
            box-shadow: 2px 0 10px rgba(0,0,0,0.3);
        }
        
        #control-panel h3 {
            margin: 0 0 20px 0;
            color: #4caf50;
            font-size: 18px;
            text-align: center;
            border-bottom: 2px solid #4caf50;
            padding-bottom: 10px;
        }
        
        #control-panel h4 { 
            margin: 20px 0 8px 0; 
            color: #ccc; 
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        #control-panel hr { 
            margin: 15px 0; 
            border: none; 
            border-top: 1px solid #404040; 
        }
        
        /* Navigation Buttons */
        .nav-item { 
            padding: 12px 15px; 
            margin: 6px 0; 
            background: #404040; 
            border: 1px solid #555; 
            cursor: pointer; 
            border-radius: 6px; 
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .nav-item:hover { 
            background: #4caf50; 
            transform: translateX(5px);
        }
        
        .nav-item.active {
            background: #4caf50;
            border-color: #66bb6a;
        }
        
        .nav-item i {
            width: 20px;
            text-align: center;
        }
        
        /* ADOM Selector Styles */
        .adom-selector {
            margin: 10px 0;
            padding: 8px;
            background: #1a1a1a;
            border: 1px solid #555;
            border-radius: 4px;
        }
        
        .adom-selector label {
            display: block;
            color: #4caf50;
            font-size: 12px;
            margin-bottom: 5px;
            text-transform: uppercase;
        }
        
        .adom-selector select {
            width: 100%;
            padding: 6px;
            background: #404040;
            border: 1px solid #555;
            border-radius: 3px;
            color: #fff;
            font-size: 12px;
        }
        
        .adom-selector select:focus {
            outline: none;
            border-color: #4caf50;
        }
        
        .adom-discover-btn {
            width: 100%;
            padding: 6px;
            margin-top: 5px;
            background: #2196f3;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            transition: background 0.3s;
        }
        
        .adom-discover-btn:hover {
            background: #1976d2;
        }
        
        /* Control Buttons */
        .control-btn {
            width: 100%; 
            margin: 4px 0; 
            padding: 10px;
            background: #555;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }
        
        .control-btn:hover {
            background: #666;
        }
        
        .control-btn.danger {
            background: #f44336;
        }
        
        .control-btn.danger:hover {
            background: #d32f2f;
        }
        
        .control-btn.primary {
            background: #2196f3;
        }
        
        .control-btn.primary:hover {
            background: #1976d2;
        }
        
        /* Main Content Area */
        #main-content { 
            flex: 1; 
            position: relative; 
            background: #1a1a1a;
        }
        
        /* Content Sections */
        .content-section {
            display: none;
            padding: 20px;
            height: calc(100vh - 40px);
            overflow-y: auto;
        }
        
        .content-section.active {
            display: block;
        }
        
        /* Header Controls with ADOM Info */
        #header-controls { 
            position: absolute; 
            top: 15px; 
            right: 15px; 
            display: flex; 
            gap: 10px;
            z-index: 1000;
        }
        
        .header-btn {
            padding: 10px 15px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .header-btn:hover {
            background: rgba(76, 175, 80, 1);
        }
        
        /* ADOM Status Badge */
        .adom-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(33, 150, 243, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 1000;
            display: none;
        }
        
        .adom-badge.show {
            display: block;
        }
        
        /* Status Display */
        #status-display { 
            position: absolute; 
            bottom: 15px; 
            left: 15px; 
            background: rgba(45, 45, 45, 0.95); 
            padding: 15px; 
            max-width: 400px; 
            border-radius: 8px;
            border: 1px solid #404040;
        }
        
        .status-chip { 
            display: inline-block; 
            padding: 6px 12px; 
            margin-right: 6px; 
            margin-bottom: 4px;
            border-radius: 20px; 
            background: #555; 
            cursor: pointer;
            transition: background 0.3s;
            font-size: 12px;
        }
        
        .status-chip.connected { background: #4caf50; }
        .status-chip.disconnected { background: #f44336; }
        .status-chip.warning { background: #ff9800; }
        
        /* Voice Interface */
        #voice-container { 
            position: absolute; 
            bottom: 15px; 
            right: 15px; 
            background: rgba(45, 45, 45, 0.95);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #404040;
        }
        
        .voice-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .voice-btn {
            padding: 10px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .voice-toggle { background: #666; color: white; }
        .voice-toggle.enabled { background: #4caf50; }
        .voice-listen { background: #2196f3; color: white; }
        .voice-listen.listening { background: #ff5722; animation: pulse 1.5s infinite; }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* Cards and Grids */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .dashboard-card {
            background: #2d2d2d;
            border: 1px solid #404040;
            border-radius: 8px;
            padding: 20px;
            transition: transform 0.3s;
        }
        
        .dashboard-card:hover {
            transform: translateY(-2px);
            border-color: #4caf50;
        }
        
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 15px;
            color: #4caf50;
        }
        
        .card-header h3 {
            margin: 0;
            font-size: 18px;
        }
        
        .card-controls {
            display: flex;
            gap: 5px;
        }
        
        .card-control-btn {
            padding: 4px 8px;
            background: #404040;
            border: 1px solid #555;
            border-radius: 3px;
            color: #ccc;
            cursor: pointer;
            font-size: 10px;
            transition: all 0.3s;
        }
        
        .card-control-btn:hover {
            background: #4caf50;
            color: white;
        }
        
        .card-content {
            color: #ccc;
        }
        
        /* Enhanced Brand Cards with ADOM */
        .brand-card {
            position: relative;
        }
        
        .brand-adom-info {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 10px;
            background: rgba(33, 150, 243, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 10px;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #404040;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #4caf50;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #ccc;
            font-size: 14px;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #ccc;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            background: #404040;
            border: 1px solid #555;
            border-radius: 4px;
            color: white;
            font-size: 14px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #4caf50;
        }
        
        /* Loading Animation */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .loading-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid #404040;
            border-top: 3px solid #4caf50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: white;
            margin-top: 15px;
            text-align: center;
        }
        
        /* Toast Notifications */
        #toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
        }
        
        .toast {
            background: #4caf50;
            color: white;
            padding: 15px 20px;
            border-radius: 6px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 300px;
            transform: translateX(400px);
            animation: slideIn 0.3s ease forwards;
        }
        
        .toast.error { background: #f44336; }
        .toast.warning { background: #ff9800; }
        .toast.info { background: #2196f3; }
        
        @keyframes slideIn {
            to { transform: translateX(0); }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            body { flex-direction: column; }
            #control-panel { width: 100%; height: 200px; padding: 10px; }
            #main-content { flex: 1; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .dashboard-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Control Panel Sidebar -->
    <div id="control-panel">
        <h3><i class="fas fa-network-wired"></i> Network NOC</h3>
        
        <h4><i class="fas fa-tachometer-alt"></i> Navigation</h4>
        <div class="nav-item active" onclick="showSection('overview')">
            <i class="fas fa-home"></i>
            <span>Overview Dashboard</span>
        </div>
        <div class="nav-item" onclick="showSection('investigation')">
            <i class="fas fa-search"></i>
            <span>Store Investigation</span>
        </div>
        <div class="nav-item" onclick="showSection('brand-BWW')">
            <i class="fas fa-utensils"></i>
            <span>Buffalo Wild Wings</span>
        </div>
        <div class="nav-item" onclick="showSection('brand-ARBYS')">
            <i class="fas fa-hamburger"></i>
            <span>Arby's</span>
        </div>
        <div class="nav-item" onclick="showSection('brand-SONIC')">
            <i class="fas fa-car"></i>
            <span>Sonic Drive-In</span>
        </div>
        
        <hr>
        <h4><i class="fas fa-tools"></i> Management Tools</h4>
        <div class="nav-item" onclick="showSection('fortimanager')">
            <i class="fas fa-shield-alt"></i>
            <span>FortiManager</span>
        </div>
        
        <!-- ADOM Selectors for Each FortiManager -->
        <div class="adom-selector">
            <label>BWW ADOM:</label>
            <select id="adomBWW" onchange="updateAdom('BWW', this.value)">
                <option value="root">root (default)</option>
            </select>
            <button class="adom-discover-btn" onclick="discoverAdoms('BWW')">
                <i class="fas fa-search"></i> Discover ADOMs
            </button>
        </div>
        
        <div class="adom-selector">
            <label>ARBYS ADOM:</label>
            <select id="adomARBYS" onchange="updateAdom('ARBYS', this.value)">
                <option value="root">root (default)</option>
            </select>
            <button class="adom-discover-btn" onclick="discoverAdoms('ARBYS')">
                <i class="fas fa-search"></i> Discover ADOMs
            </button>
        </div>
        
        <div class="adom-selector">
            <label>SONIC ADOM:</label>
            <select id="adomSONIC" onchange="updateAdom('SONIC', this.value)">
                <option value="root">root (default)</option>
            </select>
            <button class="adom-discover-btn" onclick="discoverAdoms('SONIC')">
                <i class="fas fa-search"></i> Discover ADOMs
            </button>
        </div>
        
        <div class="nav-item" onclick="showSection('fortianalyzer')">
            <i class="fas fa-chart-line"></i>
            <span>FortiAnalyzer</span>
        </div>
        <div class="nav-item" onclick="showSection('webfilters')">
            <i class="fas fa-filter"></i>
            <span>Web Filters</span>
        </div>
        
        <hr>
        <h4><i class="fas fa-brain"></i> AI Controls</h4>
        <button class="control-btn primary" onclick="toggleLTMSystem()">
            <i class="fas fa-robot"></i>
            LTM Intelligence
        </button>
        <button class="control-btn" onclick="refreshData()">
            <i class="fas fa-sync-alt"></i>
            Refresh Data
        </button>
        <button class="control-btn" onclick="exportTopology()">
            <i class="fas fa-download"></i>
            Export Topology
        </button>
        
        <hr>
        <h4><i class="fas fa-microphone"></i> Voice Control</h4>
        <div style="text-align: center; margin: 10px 0;">
            <button class="control-btn primary" id="voiceToggle" onclick="toggleVoice()">
                <i class="fas fa-microphone"></i>
                Enable Voice
            </button>
        </div>
        
        <hr>
        <button class="control-btn danger" onclick="if(confirm('Clear all data?')) clearAll()">
            <i class="fas fa-trash"></i>
            Emergency Reset
        </button>
    </div>

    <!-- Main Content Area -->
    <div id="main-content">
        <!-- ADOM Status Badge -->
        <div id="adomBadge" class="adom-badge">
            <i class="fas fa-network-wired"></i>
            <span id="adomBadgeText">ADOM: root</span>
        </div>
        
        <!-- Header Controls -->
        <div id="header-controls">
            <button class="header-btn" onclick="showAllAdomStatus()">
                <i class="fas fa-info-circle"></i>
                ADOM Status
            </button>
            <button class="header-btn" onclick="generateReport()">
                <i class="fas fa-file-pdf"></i>
                Generate Report
            </button>
            <button class="header-btn" onclick="showSettings()">
                <i class="fas fa-cog"></i>
                Settings
            </button>
        </div>

        <!-- Overview Section -->
        <div id="overview" class="content-section active">
            <h2 style="color: #4caf50; margin-bottom: 30px;">
                <i class="fas fa-tachometer-alt"></i> Network Operations Dashboard
            </h2>
            
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalStores">-</div>
                    <div class="stat-label">Total Stores</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="securityEvents">-</div>
                    <div class="stat-label">Security Events</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="blockedUrls">-</div>
                    <div class="stat-label">Blocked URLs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="healthyDevices">-</div>
                    <div class="stat-label">Healthy Devices</div>
                </div>
            </div>
            
            <!-- Dashboard Grid with ADOM Controls -->
            <div class="dashboard-grid" id="brandsGrid">
                <!-- Brand cards will be populated by JavaScript with ADOM info -->
            </div>
        </div>

        <!-- Investigation Section -->
        <div id="investigation" class="content-section">
            <h2 style="color: #4caf50; margin-bottom: 30px;">
                <i class="fas fa-search"></i> Store Investigation
            </h2>
            
            <div class="dashboard-card">
                <div class="card-header">
                    <div>
                        <i class="fas fa-store"></i>
                        <h3>Store Analysis</h3>
                    </div>
                    <div class="card-controls">
                        <button class="card-control-btn" onclick="showAdomHelp()">
                            <i class="fas fa-question-circle"></i> ADOM Help
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="form-group">
                        <label for="investigationBrand">Select Brand:</label>
                        <select id="investigationBrand" class="form-control">
                            <option value="">Choose a brand...</option>
                            <option value="BWW">Buffalo Wild Wings</option>
                            <option value="ARBYS">Arby's</option>
                            <option value="SONIC">Sonic Drive-In</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="investigationStore">Store ID:</label>
                        <input type="text" id="investigationStore" class="form-control" placeholder="e.g., 155">
                    </div>
                    <div class="form-group">
                        <label for="investigationPeriod">Time Period:</label>
                        <select id="investigationPeriod" class="form-control">
                            <option value="1h">Last Hour</option>
                            <option value="24h" selected>Last 24 Hours</option>
                            <option value="7d">Last 7 Days</option>
                            <option value="30d">Last 30 Days</option>
                        </select>
                    </div>
                    <button class="control-btn primary" onclick="runInvestigation()">
                        <i class="fas fa-play"></i>
                        Start Investigation
                    </button>
                    <div style="margin-top: 10px; font-size: 12px; color: #ccc;">
                        <i class="fas fa-info-circle"></i> 
                        Investigation will use the currently selected ADOM for the chosen brand.
                    </div>
                </div>
            </div>
        </div>

        <!-- Brand Sections (enhanced with ADOM awareness) -->
        <div id="brand-BWW" class="content-section">
            <h2 style="color: #4caf50; margin-bottom: 30px;">
                <i class="fas fa-utensils"></i> Buffalo Wild Wings Network
                <span style="font-size: 14px; color: #2196f3; margin-left: 20px;">
                    ADOM: <span id="currentBWWAdom">root</span>
                </span>
            </h2>
            <div style="margin-bottom: 20px;">
                <button class="control-btn primary" style="width: auto; margin-right: 10px;" onclick="viewFortiManagerDevices('BWW', getCurrentAdom('BWW'))">
                    <i class="fas fa-router"></i>
                    View All BWW Devices
                </button>
                <button class="control-btn" style="width: auto; margin-right: 10px;" onclick="discoverAdoms('BWW')">
                    <i class="fas fa-search"></i>
                    Discover ADOMs
                </button>
                <button class="control-btn" style="width: auto;" onclick="refreshBrandData('BWW')">
                    <i class="fas fa-sync-alt"></i>
                    Refresh
                </button>
            </div>
            <div id="brand-BWW-content">Loading...</div>
        </div>

        <div id="brand-ARBYS" class="content-section">
            <h2 style="color: #4caf50; margin-bottom: 30px;">
                <i class="fas fa-hamburger"></i> Arby's Network
                <span style="font-size: 14px; color: #2196f3; margin-left: 20px;">
                    ADOM: <span id="currentARBYSAdom">root</span>
                </span>
            </h2>
            <div style="margin-bottom: 20px;">
                <button class="control-btn primary" style="width: auto; margin-right: 10px;" onclick="viewFortiManagerDevices('ARBYS', getCurrentAdom('ARBYS'))">
                    <i class="fas fa-router"></i>
                    View All Arby's Devices
                </button>
                <button class="control-btn" style="width: auto; margin-right: 10px;" onclick="discoverAdoms('ARBYS')">
                    <i class="fas fa-search"></i>
                    Discover ADOMs
                </button>
                <button class="control-btn" style="width: auto;" onclick="refreshBrandData('ARBYS')">
                    <i class="fas fa-sync-alt"></i>
                    Refresh
                </button>
            </div>
            <div id="brand-ARBYS-content">Loading...</div>
        </div>

        <div id="brand-SONIC" class="content-section">
            <h2 style="color: #4caf50; margin-bottom: 30px;">
                <i class="fas fa-car"></i> Sonic Drive-In Network
                <span style="font-size: 14px; color: #2196f3; margin-left: 20px;">
                    ADOM: <span id="currentSONICAdom">root</span>
                </span>
            </h2>
            <div style="margin-bottom: 20px;">
                <button class="control-btn primary" style="width: auto; margin-right: 10px;" onclick="viewFortiManagerDevices('SONIC', getCurrentAdom('SONIC'))">
                    <i class="fas fa-router"></i>
                    View All Sonic Devices
                </button>
                <button class="control-btn" style="width: auto; margin-right: 10px;" onclick="discoverAdoms('SONIC')">
                    <i class="fas fa-search"></i>
                    Discover ADOMs
                </button>
                <button class="control-btn" style="width: auto;" onclick="refreshBrandData('SONIC')">
                    <i class="fas fa-sync-alt"></i>
                    Refresh
                </button>
            </div>
            <div id="brand-SONIC-content">Loading...</div>
        </div>

        <!-- FortiManager Section with enhanced ADOM controls -->
        <div id="fortimanager" class="content-section">
            <h2 style="color: #4caf50; margin-bottom: 30px;">
                <i class="fas fa-shield-alt"></i> FortiManager Administration
            </h2>
            <div id="fortimanagerContent">Loading...</div>
        </div>

        <!-- Status Display -->
        <div id="status-display">
            <strong>System Status</strong><br>
            <div id="connectionStatus" class="status-chip disconnected">
                <i class="fas fa-circle"></i>
                <span>Checking...</span>
            </div>
        </div>

        <!-- Voice Interface -->
        <div id="voice-container">
            <div class="voice-controls">
                <button id="voiceToggleMain" class="voice-btn voice-toggle" title="Toggle Voice Interface">
                    <i class="fas fa-microphone"></i>
                </button>
                <button id="voiceListen" class="voice-btn voice-listen" title="Start Voice Command" disabled>
                    <i class="fas fa-microphone-alt"></i>
                </button>
                <button id="voiceHelp" class="voice-btn" style="background: #666;" title="Voice Help">
                    <i class="fas fa-question-circle"></i>
                </button>
            </div>
            <div id="voiceStatus" style="text-align: center; font-size: 12px; color: #ccc;">
                Voice Disabled
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div style="text-align: center;">
            <div class="loading-spinner"></div>
            <div class="loading-text">Processing...</div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <!-- JavaScript -->
    <script src="/static/js/dashboard.js"></script>
    <script src="/static/js/voice-interface.js"></script>
    <script src="/static/js/voice-accessibility.js"></script>
    <script src="/static/js/voice-commands.js"></script>
    
    <script>
        // Global ADOM state
        let currentAdoms = {
            'BWW': 'root',
            'ARBYS': 'root', 
            'SONIC': 'root'
        };

        // ADOM Management Functions
        function getCurrentAdom(brand) {
            return currentAdoms[brand] || 'root';
        }
        
        function updateAdom(brand, adom) {
            currentAdoms[brand] = adom;
            
            // Update current ADOM display
            const currentSpan = document.getElementById(`current${brand}Adom`);
            if (currentSpan) {
                currentSpan.textContent = adom;
            }
            
            // Update ADOM badge
            updateAdomBadge();
            
            // Refresh brand data with new ADOM
            refreshBrandData(brand);
            
            showToast(`${brand} ADOM changed to: ${adom}`, 'info');
        }
        
        function updateAdomBadge() {
            const badge = document.getElementById('adomBadge');
            const badgeText = document.getElementById('adomBadgeText');
            
            // Show active ADOMs
            const activeAdoms = Object.entries(currentAdoms)
                .filter(([brand, adom]) => adom !== 'root')
                .map(([brand, adom]) => `${brand}:${adom}`)
                .join(', ');
            
            if (activeAdoms) {
                badgeText.textContent = `ADOMs: ${activeAdoms}`;
                badge.classList.add('show');
            } else {
                badge.classList.remove('show');
            }
        }
        
        function refreshBrandData(brand) {
            if (typeof loadBrandData === 'function') {
                loadBrandData(brand);
            }
        }
        
        function showAllAdomStatus() {
            const statusText = Object.entries(currentAdoms)
                .map(([brand, adom]) => `${brand}: ${adom}`)
                .join('\n');
                
            alert(`Current ADOM Configuration:\n\n${statusText}\n\nUse the ADOM selectors in the sidebar to change ADOMs for each brand.`);
        }
        
        function showAdomHelp() {
            const helpText = `ADOM (Administrative Domain) Help:

1. Each FortiManager can have multiple ADOMs
2. ADOMs separate device management by organization or function
3. Your devices might be in specific ADOMs, not 'root'

How to find the right ADOM:
1. Click "Discover ADOMs" for each brand
2. Look for ADOMs with HIGH device counts (1000+)
3. Select the ADOM with the most devices
4. Your interface will then show ALL devices for that brand

Current ADOMs:
BWW: ${currentAdoms.BWW}
ARBYS: ${currentAdoms.ARBYS} 
SONIC: ${currentAdoms.SONIC}`;
            
            alert(helpText);
        }
        
        // Enhanced brand card creation with ADOM info
        function createBrandCardWithAdom(brand) {
            const card = document.createElement('div');
            card.className = `brand-card brand-${brand.brand_code.toLowerCase()}`;
            
            const iconMap = {
                'BWW': 'fas fa-utensils',
                'ARBYS': 'fas fa-hamburger', 
                'SONIC': 'fas fa-car'
            };
            
            const currentAdom = getCurrentAdom(brand.brand_code);
            
            card.innerHTML = `
                <div class="brand-adom-info">ADOM: ${currentAdom}</div>
                <div class="brand-header">
                    <div class="brand-icon">
                        <i class="${iconMap[brand.brand_code] || 'fas fa-store'}"></i>
                    </div>
                    <div>
                        <h3 class="brand-title">${brand.name}</h3>
                        <div class="brand-subtitle">${brand.description}</div>
                    </div>
                </div>
                <div class="brand-metrics">
                    <div class="brand-metric">
                        <span class="brand-metric-value" id="${brand.brand_code}-stores">-</span>
                        <span class="brand-metric-label">Stores</span>
                    </div>
                    <div class="brand-metric">
                        <span class="brand-metric-value" id="${brand.brand_code}-events">-</span>
                        <span class="brand-metric-label">Events</span>
                    </div>
                </div>
                <div style="margin-top: 1rem; display: flex; gap: 10px;">
                    <button class="btn btn-primary" onclick="showBrandSection('${brand.brand_code}')">
                        <i class="fas fa-arrow-right"></i>
                        View Details
                    </button>
                    <button class="btn btn-secondary" onclick="discoverAdoms('${brand.brand_code}')">
                        <i class="fas fa-search"></i>
                        ADOMs
                    </button>
                </div>
            `;
            
            return card;
        }
        
        // Override the original createBrandCard function
        if (typeof createBrandCard !== 'undefined') {
            const originalCreateBrandCard = createBrandCard;
            createBrandCard = createBrandCardWithAdom;
        }
        
        // Auto-discover ADOMs on startup
        document.addEventListener('DOMContentLoaded', function() {
            // Set up ADOM auto-discovery after a short delay
            setTimeout(() => {
                console.log('Starting ADOM auto-discovery...');
                ['BWW', 'ARBYS', 'SONIC'].forEach(brand => {
                    discoverAdomsQuietly(brand);
                });
            }, 3000);
        });
        
        // Quiet ADOM discovery (no notifications)
        async function discoverAdomsQuietly(fmName) {
            try {
                const response = await apiCall(`/api/fortimanager/${fmName}/adoms`);
                
                if (response.success && response.adom_results) {
                    // Find ADOM with highest device count
                    const bestAdom = response.adom_results
                        .filter(a => a.status === 'success')
                        .sort((a, b) => b.device_count - a.device_count)[0];
                    
                    if (bestAdom && bestAdom.device_count > 10) {
                        // Update selector
                        const selector = document.getElementById(`adom${fmName}`);
                        if (selector) {
                            // Add option if not exists
                            if (![...selector.options].some(opt => opt.value === bestAdom.adom)) {
                                const option = document.createElement('option');
                                option.value = bestAdom.adom;
                                option.textContent = `${bestAdom.adom} (${bestAdom.device_count} devices)`;
                                selector.appendChild(option);
                            }
                        }
                        
                        console.log(`Auto-discovered best ADOM for ${fmName}: ${bestAdom.adom} (${bestAdom.device_count} devices)`);
                    }
                }
            } catch (error) {
                console.log(`Quiet ADOM discovery failed for ${fmName}:`, error.message);
            }
        }
        
        // Enhanced existing functions
        function showSection(sectionId) {
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
            
            // Show selected section
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.add('active');
                currentSection = sectionId;
                
                // Update active nav item
                event?.target?.closest('.nav-item')?.classList.add('active');
                
                // Load section-specific data
                if (typeof loadSectionData === 'function') {
                    loadSectionData(sectionId);
                }
            }
        }
        
        // Voice control integration
        function toggleVoice() {
            if (typeof voiceInterface !== 'undefined') {
                voiceInterface.toggleVoice();
                const btn = document.getElementById('voiceToggle');
                const btnMain = document.getElementById('voiceToggleMain');
                
                if (voiceInterface.isEnabled) {
                    btn.innerHTML = '<i class="fas fa-microphone"></i> Disable Voice';
                    btnMain.classList.add('enabled');
                } else {
                    btn.innerHTML = '<i class="fas fa-microphone"></i> Enable Voice';
                    btnMain.classList.remove('enabled');
                }
            }
        }
        
        // System controls
        function toggleLTMSystem() {
            showToast('LTM Intelligence System is active', 'info');
        }
        
        function refreshData() {
            if (typeof refreshCurrentSection === 'function') {
                refreshCurrentSection();
            }
            showToast('Refreshing data...', 'info');
        }
        
        function exportTopology() {
            showToast('Topology export feature coming soon', 'info');
        }
        
        function generateReport() {
            showToast('Generating comprehensive network report...', 'info');
        }
        
        function showSettings() {
            showToast('Settings panel coming soon', 'info');
        }
        
        function clearAll() {
            showToast('System reset initiated', 'warning');
        }
        
        // Enhanced toast function for NOC style
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const iconMap = {
                success: 'fas fa-check-circle',
                warning: 'fas fa-exclamation-triangle',
                error: 'fas fa-times-circle',
                info: 'fas fa-info-circle'
            };
            
            toast.innerHTML = `
                <i class="${iconMap[type]}"></i>
                <span>${message}</span>
            `;
            
            container.appendChild(toast);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (container.contains(toast)) {
                    toast.style.animation = 'slideIn 0.3s ease reverse';
                    setTimeout(() => container.removeChild(toast), 300);
                }
            }, 5000);
        }
        
        // Initialize the interface
        document.addEventListener('DOMContentLoaded', function() {
            // Set up voice controls
            const voiceToggleMain = document.getElementById('voiceToggleMain');
            const voiceListen = document.getElementById('voiceListen');
            const voiceHelp = document.getElementById('voiceHelp');
            
            if (voiceToggleMain) {
                voiceToggleMain.addEventListener('click', toggleVoice);
            }
            
            if (voiceListen && typeof voiceInterface !== 'undefined') {
                voiceListen.addEventListener('click', () => {
                    voiceInterface.startListening();
                });
            }
            
            if (voiceHelp && typeof voiceInterface !== 'undefined') {
                voiceHelp.addEventListener('click', () => {
                    voiceInterface.announceVoiceHelp();
                });
            }
            
            // Welcome message
            setTimeout(() => {
                showToast('Voice-Enabled Network Management Platform ready with ADOM support!', 'success');
            }, 1000);
        });
    </script>
</body>
</html>